<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>Android Activity Lifecycle | Huasababy | </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="theme-color" content="#3F51B5">
  
  
  <meta name="keywords" content="Android,ReadingNote">
  <meta name="description" content="今年春节在家看到了一篇《Android 开发者成神之路！》的文章，文章翻译自 Vasiliy Zukanov《Android Developer Skills for 2020》。文中提到了很多我想了解的知识，比如这篇《Android Activity Lifecycle》虽然基础，但其中描述的一些内容还是我编程时会出现的错误。我想之后仔细阅读这位大神的博客内容，对关键内容进行整理总结。">
<meta name="keywords" content="Android,ReadingNote">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Activity Lifecycle">
<meta property="og:url" content="http://yoursite.com/2020/02/18/Android-Activity-Lifecycle/index.html">
<meta property="og:site_name" content="Huasababy">
<meta property="og:description" content="今年春节在家看到了一篇《Android 开发者成神之路！》的文章，文章翻译自 Vasiliy Zukanov《Android Developer Skills for 2020》。文中提到了很多我想了解的知识，比如这篇《Android Activity Lifecycle》虽然基础，但其中描述的一些内容还是我编程时会出现的错误。我想之后仔细阅读这位大神的博客内容，对关键内容进行整理总结。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-03-24T08:46:12.417Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Activity Lifecycle">
<meta name="twitter:description" content="今年春节在家看到了一篇《Android 开发者成神之路！》的文章，文章翻译自 Vasiliy Zukanov《Android Developer Skills for 2020》。文中提到了很多我想了解的知识，比如这篇《Android Activity Lifecycle》虽然基础，但其中描述的一些内容还是我编程时会出现的错误。我想之后仔细阅读这位大神的博客内容，对关键内容进行整理总结。">
  
    <link rel="alternative" href="/atom.xml" title="Huasababy" type="application/atom+xml">
  
  <meta name="summary" content="&lt;p&gt;今年春节在家看到了一篇《Android 开发者成神之路！》的文章，文章翻译自 Vasiliy Zukanov《Android Developer Skills for 2020》。文中提到了很多我想了解的知识，比如这篇《Android Activity Lifecycle》虽然基础，但其中描述的一些内容还是我编程时会出现的错误。我想之后仔细阅读这位大神的博客内容，对关键内容进行整理总结。&lt;/p&gt;">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="loading" class="active"></div>

  <nav id="menu" class="hide" >
   <div class="inner flex-row-vertical">
  <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
      <i class="icon icon-lg icon-close"></i>
  </a>
  <div class="brand-wrap">
    <div class="brand">
      <a href="/" class="avatar"><img src="/img/doge.jpg"></a>
      <hgroup class="introduce">
        <h5 class="nickname">Huasababy</h5>
        <a href="mailto:lueho110@gmail.com" title="lueho110@gmail.com" class="mail">lueho110@gmail.com</a>
      </hgroup>
    </div>
  </div>
  <div class="scroll-wrap flex-col">
    <ul class="nav">
      
          <li class="waves-block waves-effect">
            <a href="/"  >
              <i class="icon icon-lg icon-home"></i>
              主页
            </a>
          </li>
      
          <li class="waves-block waves-effect">
            <a href="/archives"  >
              <i class="icon icon-lg icon-archives"></i>
              Archives
            </a>
          </li>
      
          <li class="waves-block waves-effect">
            <a href="/tags"  >
              <i class="icon icon-lg icon-tags"></i>
              Tags
            </a>
          </li>
      
    </ul>

    <footer class="footer">
  <p><a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0;vertical-align:middle;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAAllBMVEUAAAD///+rsapERER3d3eIiIjMzMzu7u4iIiKUmZO6v7rKzsoODg4RERFVVVUNDQ0NDg0PEA8zMzNLTEtbXltmZmZydnF9gn2AgICPkI+ZmZmqqqq7u7vFxsXIzMgNDQwZGRkgICAhISEkJSMnKCcuMC4xMzE5Ozk7PTtBQkFCQkJDQ0Nna2eGhoaHh4ezuLLGysbd3d1wVGpAAAAA4UlEQVR42q2T1xqCMAyFk7QsBQeKA9x7j/d/OSm22CpX0nzcpA1/T05aAOuBVkMAScQFHLnEwoCo2f1TnQIGoVMewjZEjVFN4GH1Ue1Cn2jWqwfsOOj6wDwGvotsl/c8lv7KIq1eLOsT0HMFHMIE/RZyHnlphryT9zyV+8WH5e8yQw3wnQvgAFxPTKUVi555SHR/lOfLMgVTeDlSfN+TaoUsiTyeIm+bCkHvCA2FUKG48LDtYBZBknsYP/G8NTw0gaaHyuQf4H5pecrB/FYCT2sL9zAfy1Xyjou6L8X2W7YcLyBZCRtnq/zfAAAAAElFTkSuQmCC" /></a></p>
  <p>Huasababy &copy; 2020</p>
  <p>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme
  <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></p>
  <a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-2x icon-rss-square"></i></a>
</footer>

  </div>
</div>

  </nav>
  <main id="main">
    <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Android Activity Lifecycle</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input " autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-share">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header">
  <div class="container">
    <h1 class="author">Android Activity Lifecycle</h1>
    <h5 class="subtitle">
        
            <time datetime="2020-02-18T08:30:34.000Z" itemprop="datePublished" class="page-time">
  2020-02-18
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/ReadingNote/">ReadingNote</a></li></ul></li></ul>

        
    </h5>
  </div>
</header>

    <div class="container body-wrap">
      <article id="post-Android-Activity-Lifecycle" 
  class="article article-type-post" itemprop="blogPost">
    <div class="post-meta flex-row">
        
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReadingNote/">ReadingNote</a></li></ul>

    </div>
    <div class="post-body">
        <aside class="post-widget" id="post-widget">

            
            <div class="post-share" id="post-share">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" href="javascript:;" data-title="微博" data-service="tsina">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns" href="javascript:;" data-title="微信" data-service="weixin">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="douban share-sns" href="javascript:;" data-title="豆瓣" data-service="douban">
          豆
        </a>
      </li>
    </ul>
 </div>

            

            
            <nav class="post-toc-wrap" id="post-toc">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#简介"><span class="post-toc-number">1.</span> <span class="post-toc-text">简介</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Activity-使用指导"><span class="post-toc-number">2.</span> <span class="post-toc-text">Activity 使用指导</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#onCreate-Bundle"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">onCreate(Bundle)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#onStart"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">onStart</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#onResume"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">onResume</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#onPause"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">onPause</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#onStop"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">onStop</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#onDestory"><span class="post-toc-number">2.6.</span> <span class="post-toc-text">onDestory</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#onSaveInstanceState-Bundle"><span class="post-toc-number">2.7.</span> <span class="post-toc-text">onSaveInstanceState(Bundle)</span></a></li></ol></li></ol>
            </nav>
            
        </aside>

        <div class="post-main">

            <div class="post-content" id="post-content" itemprop="postContent">
            <p>今年春节在家看到了一篇《Android 开发者成神之路！》的文章，文章翻译自 Vasiliy Zukanov《Android Developer Skills for 2020》。文中提到了很多我想了解的知识，比如这篇《Android Activity Lifecycle》虽然基础，但其中描述的一些内容还是我编程时会出现的错误。我想之后仔细阅读这位大神的博客内容，对关键内容进行整理总结。</p>
<a id="more"></a>

<p><a href="https://www.techyourchance.com/android-activity-lifecycle/" target="_blank" rel="noopener">原文地址</a></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ol>
<li>Activity是Android框架中核心组件之一，通常它代表一个界面</li>
<li>Activity看上去很容易被理解和使用，但是真正重要的是去理解它的生命周期</li>
<li>对Activity生命周期理解的不够深入，是一个导致Android应用复杂和产生bug的重要原因</li>
</ol>
<h2 id="Activity-使用指导"><a href="#Activity-使用指导" class="headerlink" title="Activity 使用指导"></a>Activity 使用指导</h2><h3 id="onCreate-Bundle"><a href="#onCreate-Bundle" class="headerlink" title="onCreate(Bundle)"></a>onCreate(Bundle)</h3><ol>
<li>onCreate中必须要做的两件事<ul>
<li>setContentView</li>
<li>restore saved state</li>
<li>如果使用依赖注入，则在这里进行注入</li>
</ul>
</li>
<li>onCreate中不要出现的操作<ul>
<li>订阅被观察者</li>
<li>功能流程</li>
<li>开始异步功能流程</li>
<li>资源分配</li>
</ul>
</li>
<li>当我在决定一段代码逻辑是否属于onCreate时，我会问一个问题：这与初始化一个对象有关系嘛？如果答案是否定的，那我会另外找个地方放置这些代码</li>
<li>onCreate运行完成后，它将变为“created” state<ul>
<li><code>created</code>Activity 不应该引起额外的资源分配，不应该接受到其他的事件</li>
<li><code>created</code>状态等同于,<code>ready, but inactive and isolated</code>状态</li>
</ul>
</li>
</ol>
<h3 id="onStart"><a href="#onStart" class="headerlink" title="onStart"></a>onStart</h3><blockquote>
<p>由于用户要配合使用，AndroidFragment会调用<code>onStart()</code>方法。这个方法会将<code>created</code>状态下的Activity变为可以使用的状态<code>started</code>(bring to Life)</p>
</blockquote>
<ol>
<li>以下的操作都应该在onStart中进行<ul>
<li>View的点击事件的注册</li>
<li>被观察者的订阅</li>
<li>反应当前状态下的UI展示（UI update）</li>
<li>功能流程流程启动</li>
<li>异步功能流程启动</li>
<li>资源的分配</li>
</ul>
</li>
<li>对于上述前两点，被观察者的订阅也在<code>onStart()</code>中进行的疑问，我们在 <code>onStop()</code>中进行解释</li>
</ol>
<h3 id="onResume"><a href="#onResume" class="headerlink" title="onResume"></a>onResume</h3><blockquote>
<p>该方法执行后，Activity由 <code>started</code>状态变为<code>resumed</code>状态，代表Activity正在与用户进行交互</p>
</blockquote>
<p>对于<code>onResume</code>使用的两个规则</p>
<ol>
<li>你不需要<code>onResume</code>方法</li>
<li>你确实需要<code>onResume</code>方法仅存在很特殊的条件下。我的观点中，该方法应该只被用于开启或移除<code>moving stuff</code>(不太明白作者说的这个情况)</li>
</ol>
<h3 id="onPause"><a href="#onPause" class="headerlink" title="onPause"></a>onPause</h3><blockquote>
<p>在这个方法中，我们应该做的是将<code>onResume()</code>中启动的动画、视频暂停或停止，所以就像<code>onResume()</code>方法，我们应该很少用到<code>onPause()</code>除非一些特殊的情况下。在该方法调用后，Activity会由<code>resumed</code>状态重新回到<code>started</code>状态</p>
</blockquote>
<ol>
<li>选择<code>onPause()</code>状态中处理逻辑，一定是只能在该方法下才能处理的情况。目前只有<ul>
<li>Activity由于多窗口状态下失去焦点</li>
<li>Activity被另一个界面遮盖部分，像系统Dialog</li>
</ul>
</li>
<li>相机是一个比较特殊的例子，因为相机目前作为被多个应用同时公用的一个资源<ul>
<li>可能需要在<code>onPause()</code>释放相机以便其他应用使用相机</li>
<li>Android10开始，相机在多Activity情形有所调整，具体可以看<a href="https://source.android.com/devices/tech/display/multi_display/multi-resume" target="_blank" rel="noopener">这篇文章</a></li>
</ul>
</li>
</ol>
<h3 id="onStop"><a href="#onStop" class="headerlink" title="onStop"></a>onStop</h3><blockquote>
<p>这个方法中我通常会取消全部对被观察者的订阅，并释放全部在<code>onStart()</code>方法中对资源的分配。<code>onStop()</code>执行过后，Activity会变为<code>created</code>状态</p>
</blockquote>
<p>为什么我们应该在<code>onStart()</code>与<code>onStop()</code>中注册、取消对被观察者的监听？如果不放在<code>onStop()</code>中，那就只有放在<code>onPause()</code>与<code>onDestory()</code>中</p>
<ol>
<li>在<code>onPause()</code>中进行取消订阅，这将意味着如果用户处在多屏模式下，将无法看到应用页面收到消息后的变化的。而用户进入多屏模式下，固然还是需要看到应用在收到消息时产生的变化。</li>
<li>在<code>onDestory()</code>中进行取消订阅同样也不是一个很好的选择。<ul>
<li>当应用进入后台，Activity调用<code>onStop()</code>方法后，转变为<code>created</code>状态，应用可能保持这个状态几天甚至是几周。如果依赖中被观察者发生了事件的回调，Activity将在后台持有这些事件。这将是对电池寿命的浪费，甚至会导致不可预期的效果。</li>
<li>对观察者的注册会导致对内存更高的消费，所以整个应用更容易被Android系统在低内存下杀死</li>
</ul>
</li>
<li>在<code>SDKVersion 19</code>可以安全的在<code>onCreate()</code>对View进行监听的注册，并且不需要取消对它们的监听</li>
</ol>
<h3 id="onDestory"><a href="#onDestory" class="headerlink" title="onDestory"></a>onDestory</h3><blockquote>
<p>这个方法我们应该永远不要重写</p>
</blockquote>
<ol>
<li>如果按照我们规定的在<code>onCreate()</code>中进行了初始化，没有其他的逻辑，在<code>onCreate()</code>真的不需要我们去做什么</li>
<li>当我去检查Android代码库时,我通常会查看几个常用错误和反设计模式的部分，调整代码使其变为高质量的代码。<code>onDestory</code>的重写就是我去检查的地方</li>
</ol>
<h3 id="onSaveInstanceState-Bundle"><a href="#onSaveInstanceState-Bundle" class="headerlink" title="onSaveInstanceState(Bundle)"></a>onSaveInstanceState(Bundle)</h3><blockquote>
<p>这个方法一般用于在界面配置状态改变时进行保存数据</p>
</blockquote>
<ol>
<li>在这个方法中唯一需要做的事情就是保存当前的状态</li>
<li>关于Activity中如果有Fragment，若<code>Fragment transaction</code>在该方法执行后被<code>commit</code>，将会出现<code>IllegalStateException</code>异常，以下有几种处理方式<ul>
<li>不去处理，接受这些极端的bug造成的崩溃</li>
<li>使用<code>commitAllowingStateLoss()</code>，并接受一些保存状态的丢失</li>
<li>界面中不再使用<code>Fragment</code></li>
<li>对异常情况挨个进行处理，这可能导致有些漏掉的情况依然会导致崩溃</li>
</ul>
</li>
<li><code>onSaveInstanceState</code>的调用时机<ul>
<li>在23版之前，该方法会在<code>onStop</code>之前调用</li>
<li>在23版之后，该方法会在<code>onStop</code>之后调用</li>
</ul>
</li>
<li>Google关于Lifecycle使用的介绍中，也描述了这个场景及相应的解决方法:<a href="https://developer.android.google.cn/topic/libraries/architecture/lifecycle#onStop-and-savedState" target="_blank" rel="noopener">处理ON_STOP事件</a></li>
</ol>


            
            <div class="post-reward">
                <a id="rewardBtn" href="javascript:;" class="post-reward-btn waves-effect waves-circle waves-light">赏</a>
            </div>
            
            
            <blockquote>
                <p>
                本文地址：
                <a href="http://yoursite.com/2020/02/18/Android-Activity-Lifecycle/" target="_blank" rel="external">http://yoursite.com/2020/02/18/Android-Activity-Lifecycle/</a>
                </p>
                <footer><cite><a href="http://yoursite.com">@Huasababy</a></cite></footer>
            </blockquote>
            </div>
            
<nav class="post-nav">
  
    <div class="waves-block waves-effect prev fl">
      <a href="/2020/05/30/EventBus-使用建议/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">EventBus 使用建议</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next fr">
      <a href="/2019/12/02/单元测试学习笔记/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">单元测试学习笔记</h4>
      </a>
    </div>
  
</nav>


            
            
<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="Android-Activity-Lifecycle" data-title="Android Activity Lifecycle" data-url="http://yoursite.com/2020/02/18/Android-Activity-Lifecycle/index.html"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"ysblog"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>





        </div>
    </div>
</article>

<div id="reward" class="reward-lay">
    <a class="reward-off" id="rewardOff" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <ul class="reward-items">
        
        <li>
            <img src="/img/wx_get.png" title="微信打赏二维码" alt="微信打赏二维码">
            <p>微信</p>
        </li>
        

        
    </ul>
</div>

    </div>
  </main>
<div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>

<script>
var BLOG_SHARE = {
    title: "Android Activity Lifecycle",
    pic: "/img/doge.jpg",
    summary: document.getElementsByName('summary')[0].content,
    url: "http://yoursite.com/2020/02/18/Android-Activity-Lifecycle/index.html"
};
</script>
<div class="global-share" id="global-share">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" href="javascript:;" data-title="微博" data-service="tsina">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns" href="javascript:;" data-title="微信" data-service="weixin">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="douban share-sns" href="javascript:;" data-title="豆瓣" data-service="douban">
          豆
        </a>
      </li>
    </ul>
 </div>


<script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script src="/js/main.js"></script>



<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<script type="text/template" id="search-tpl">
<li class="item">
    <a href="/{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</script>

<script src="/js/search.js"></script>









</body>
</html>
